<style>
    .instructions-container {
        font-family: Arial, sans-serif;
        margin: 0 auto;
        max-width: 800px;
        padding: 20px;
    }
    .section {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 15px;
        background-color: #f8f8f8;
    }
    .sectionbis {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 15px;
        background-color: #ffcccb;
    }
    .section-header {
        font-weight: bold;
        margin-bottom: 10px;
    }
    .instructions-container img {
        display: block;
        margin: 0 auto;
        max-width: 100%;
        height: auto;
    }
</style>

<div class="instructions-container">
    <h1>実験の説明</h1>


    {% if player.session.config.get('treatment') == 'test' and player.round_number > 1 and player.round_number != 5 %}
    <div class="sectionbis">
        <div class="section-header">新しいルール</div>
        <p>第2ラウンド以降、実験のルールが少しずつ変わります。赤い色付き部分が、そのラウンドの新しいルールです。他の説明部分は変わりません。</p>
    </div>
    {% elif player.round_number == 5 %}
    <div class="sectionbis">
        <div class="section-header">新しいルール</div>
        <p>次のラウンドからは、役割が変わります。プレイヤー1だった場合はプレイヤー2になり、プレイヤー2だった場合はプレイヤー1になります。指示の赤いセクションを注意深くお読みください。灰色のセクションは前のラウンドと同様です。</p>
    </div>
    {% endif %}

    <div class="section">
        <div class="section-header"></div>
        <p>実験へのご参加ありがとうございます。この実験では、他の参加者とランダムにペアになり、ある、金額を2人で分けるための交渉を何ラウンドか行います。各ラウンドの交渉終了後、次のラウンドでは他の参加者とペアになります。</p>
    </div>

    <div class="section">
        <div class="section-header">実験の目標</div>
        <p>あなたの目標は{{ C.PIE_SIZE }}実験通貨単位(ECU)を二人でどのように分けるかの合意に達することです。合意に達しない場合、「不合意」ステージに自動的に移動します。その内容の詳細は「合意に達しない場合」のセクションで説明されます。</p>
    </div>

    <div class="section">
        <div class="section-header">時間制限</div>
        <p>交渉には{{ C.timer|to0 }}分の時間制限があります。この時間内に合意に達しない場合、そのラウンドは終了し、「不合意」ステージに自動
            的に移動します。</p>
    </div>

    <div class="section">
        <div class="section-header">各ラウンドでの役割</div>
        <p>各ラウンドで、各参加者のペアは一人がプレイヤー1、他方がプレイヤー2としてランダムに割り当てられます。</p>
    </div>

    <h2>各ラウンドでの交渉の進め方</h2>

    <div class="section">
        <div class="section-header">チャット機能</div>
        <p>各ラウンドでの交渉中、チャット機能を使用してパートナーと交渉に関するコミュニケーションをとることができます。下の画像は、実験中に表示されるチャットの様子です。チャットでは、自分の個人情報や、相手を侮辱するような言葉を入力してはいけません。</p>
        <img src="{{ static 'gb_live_bargaining/images/instructions_chat.png' }}" alt="チャット" width="450">
    </div>

    <div class="section">
        <div class="section-header">オファーの送信</div>
        <p>から{{ C.PIE_SIZE }}の範囲の0以上の整数で、二つの金額の合計は{{ C.PIE_SIZE }}でなければなりません。オファーを入力したら、「オファーを送信」をクリックして他のプレイヤーに送信してください。オファーが送信されると、「あなたの現在のオファー」として下の図の右側のように表示されます。</p>
        <p>既にオファーを送信した後でも、新しいオファーを上書きして作成し、送信することができます。そうすると、以前のオファーは置き換えられ
            ます。</p>
        <img src="{{ static 'gb_live_bargaining/images/instructions_offer.png' }}" alt="オファーの提示">
    </div>

    <div class="section">
        <div class="section-header">オファーへの対応</div>
        <p>他のプレイヤーからオファーを受け取った場合、それを受け入れるかどうか選ぶことができます。無視しても構いません。「承認」をクリックして、オファーを受け入れると、そのラウンド(タスク)は終了し、{{ C.PIE_SIZE }} ECUがそのオファーのとおりに分配されます。</p>
        <img src="{{ static 'gb_live_bargaining/images/instructions_accept.png' }}" alt="オファーへの対応" width="320">
    </div>

    <div class="section">
        <div class="section-header">オファーのキャンセル</div>
        <p>他のプレイヤーが承認する前に自分のオファーを撤回したい場合は、「オファーをキャンセル」をクリックしてください。そうすると、以前のオファーを他のプレイヤーが承認することができなくなります。新しいオファーを作成することは引き続き可能です。</p>
        <img src="{{ static 'gb_live_bargaining/images/instructions_cancel.png' }}" alt="オファーのキャンセル" width="400">
    </div>

    <div class="section">
        <div class="section-header">交渉の停止</div>
        <p>交渉を続けずに、不合意ステージに入りたい場合は、「交渉中止」をクリックしてください。 これにより、交渉は打ち切られ、不合意ステージに移動し、ステージでの指示に従った後、そのラウンドが終了します。ポップアップウィンドウが表示され、交渉停止の決定を確認する必要があります。</p>
        <img src="{{ static 'gb_live_bargaining/images/instructions_stop.png' }}" alt="交渉の停止" width="150">
    </div>

    <h2>不合意ステージ</h2>

    {% if player.session.config.get('treatment') == 'bargain'
    or player.session.config.get('treatment') == 'test' and player.round_number == 1
    or player.session.config.get('treatment') == 'test' and player.round_number == 5 %}
        <div class="section">
            <div class="section-header"></div>
                <p>交渉時間の終了前またはプレイヤーが合意なしで交渉を終了することを決定した場合、交渉不一致のステージにはいります。第１ラウンドでは、ECUは以下のように自動的に割り当てられます：プレイヤー1は{{ C.DISAGREEMENT_PAYOFF_P1 }}ECUを受け取り、プ レイヤー2は{{ C.DISAGREEMENT_PAYOFF_P2 }}ECUを受け取ります。このステージでの指示はラウンドごとに変わります。</p>
        </div>
    {% else %}
        <div class="sectionbis">
            <div class="section-header"></div>
                <p>ラウンド2以降の交渉の不合意ステージは次のようになります。 不合意の場合、プレイヤー１とプレイヤー2は独立に選択1か選択2を取ります。このステージではチャットを使うことはできません。</p>
        </div>
    {% endif %}

    {% if player.session.config.get('treatment') == 'prisoner'
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 2
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 3
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 4
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 6
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 7
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 8 %}
        <div class="sectionbis">
            <div class="section-header"></div>
            <p>この不合意ステージでは、あなたと相手は、以下の表の二つの選択肢のうちの一つを独立して選ぶ必要があります。あなたへの報酬は、あなたの決定と他のプレイヤーの決定の両方に依存します：</p>
            <ul>
                <li>両方のプレイヤーが選択肢1を選んだ場合、それぞれ{{ C.mutual_cooperation_payoff_PD }} ECUを獲得します。</li>
                <li>一方が選択肢1を選び、もう一方が選択肢2を選んだ場合、選択肢2を選んだプレイヤーは{{ C.betray_payoff_PD }} ECUを獲得し、他方は{{ C.betrayed_payoff_PD }} ECUを獲得します。</li>
                <li>両方のプレイヤーが選択肢2を選んだ場合、プレイヤー1は{{ C.mutual_betrayal_payoff_PD_p1 }} ECUを獲得し、プレイヤー2は{{ C.mutual_betrayal_payoff_PD_p2 }} ECUを獲得します。</li>
            </ul>
            <p>不合意ステージで選択を行うには、表の選択1または選択2をクリックするだけです。</p>
            <table class="table table-bordered text-center">
                <thead>
                <tr>
                    <th></th>
                    <th>相手の選択1</th>
                    <th>相手の選択2</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>選択1</td>
                    <td><strong>{{ C.mutual_cooperation_payoff_PD }}</strong>, {{ C.mutual_cooperation_payoff_PD }}</td>
                    <td><strong>{{ C.betrayed_payoff_PD }}</strong>, {{ C.betray_payoff_PD }}</td>
                </tr>
                <tr>
                    <td>選択2</td>
                    <td><strong>{{ C.betray_payoff_PD }}</strong>, {{ C.betrayed_payoff_PD }}</td>
                    {% if player.id_in_group == 1 %}
                        <td><strong>{{ C.mutual_betrayal_payoff_PD_p1 }}</strong>, {{ C.mutual_betrayal_payoff_PD_p2 }}</td>
                    {% else %}
                        <td><strong>{{ C.mutual_betrayal_payoff_PD_p2 }}</strong>, {{ C.mutual_betrayal_payoff_PD_p1 }}</td>
                    {% endif %}
                </tr>
                </tbody>
            </table>
        </div>

    {% elif player.session.config.get('treatment') == 'staghunt'
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 3
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 4
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 2
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 7
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 8
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 6 %}
        <div class="sectionbis">
            <div class="section-header"></div>
            <p>この不合意ステージでは、あなたと相手は、以下の表の二つの選択肢のうちの一つを独立して選ぶ必要があります。あなたへの報酬は、あなたの決定と他のプレイヤーの決定の両方に依存します：</p>
            <ul>
                <li>両方のプレイヤーが選択肢1を選んだ場合、それぞれ{{ C.both_stag_payoff }} ECUを獲得します。</li>
                <li>プレイヤー1が選択肢1を選び、プレイヤー2が選択肢2を選んだ場合、プレイヤー1は{{ C.stag_hare_payoff }} ECUを獲得し、プレイヤー2は{{ C.hare_stag_payoff_p2 }} ECUを獲得します。</li>
                <li>プレイヤー1が選択肢2を選び、プレイヤー2が選択肢1を選んだ場合、プレイヤー1は{{ C.hare_stag_payoff_p1 }} ECUを獲得し、プレイヤー2は{{ C.stag_hare_payoff }} ECUを獲得します。</li>
                <li>両方のプレイヤーが選択肢2を選んだ場合、プレイヤー1は{{ C.both_hare_payoff_p1 }} ECUを獲得し、プレイヤー2は{{ C.both_hare_payoff_p2 }} ECUを獲得します。</li>
            </ul>
            <p>不合意ステージで選択を行うには、表の選択1または選択2をクリックするだけです。</p>
            <table class="table table-bordered text-center">
                <thead>
                <tr>
                    <th></th>
                    <th>相手の選択1</th>
                    <th>相手の選択2</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>選択1</td>
                    <td><strong>{{ C.both_stag_payoff }}</strong>, {{ C.both_stag_payoff }}</td>
                    {% if player.id_in_group == 1 %}
                        <td><strong>{{ C.stag_hare_payoff }}</strong>, {{ C.hare_stag_payoff_p2 }}</td>
                    {% else %}
                        <td><strong>{{ C.stag_hare_payoff }}</strong>, {{ C.hare_stag_payoff_p1 }}</td>
                    {% endif %}
                </tr>
                <tr>
                    <td>選択2</td>
                    {% if player.id_in_group == 1 %}
                        <td><strong>{{ C.hare_stag_payoff_p1 }}</strong>, {{ C.stag_hare_payoff }}</td>
                    {% else %}
                        <td><strong>{{ C.hare_stag_payoff_p2 }}</strong>, {{ C.stag_hare_payoff }}</td>
                    {% endif %}
                    {% if player.id_in_group == 1 %}
                        <td><strong>{{ C.both_hare_payoff_p1 }}</strong>, {{ C.both_hare_payoff_p2 }}</td>
                    {% else %}
                        <td><strong>{{ C.both_hare_payoff_p2 }}</strong>, {{ C.both_hare_payoff_p1 }}</td>
                    {% endif %}
                </tr>
                </tbody>
            </table>
        </div>
    {% elif player.session.config.get('treatment') == 'ultimatum'
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 4
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 2
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 3
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 1 and player.round_number == 8
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 2 and player.round_number == 6
        or player.session.config.get('treatment') == C.TEST and player.session.config.get('order') == 3 and player.round_number == 7 %}
        <div class="sectionbis">
            <div class="section-header"></div>
            <p>この不合意ステージでは、プレイヤー2が{{ C.PIE_SIZE }} ECUの分割を提案します。</p>
            <p>その後、プレイヤー1がオファーを受け取ります。彼はそれを受け入れるか拒否するか選べます。</p>
            <p></p>
            <ul>
                <li>プレイヤー1がオファーを受け入れた場合、{{ C.PIE_SIZE }} ECUはプレイヤー2によって提案された通りに割り当てられます。</li>
                <li>プレイヤー1がオファーを拒否した場合、プレイヤー1は{{ C.reject_payoff_p1 }} ECUを受け取り、プレイヤー2は{{ C.reject_payoff_p2 }} ECUを受け取ります。</li>
            </ul>
        </div>
    {% endif %}

    <h2>報酬</h2>

    <div class="section">
        <div class="section-header"></div>
        <p>実験では、上記の交渉を繰り返します。チャット機能も自由に使って構いません。実験終了後、全てのラウンドの中からコンピューターによってランダムに1ラウンドが選ばれ、そこで実際に獲得したECUが円に変換され、皆さんへの謝礼となります。変換レートは1 ECU = {{ C.CONVERSION_RATE|c }}です。</p>
        <p>上記の謝礼に、実験への参加謝礼{{ player.participation_fee }}を加えたものが、本日の最終受取額になります。</p>
    </div>

    {% if  player.round_number == 1 %}
        <div class="section">
        <div class="section-header"></div>
        <p>ここまでで、何か質問がある人は挙手して実験者に知らせてください。質問がなければ「次へ」をクリックして、クイズに答えてください。全問正解する必要があります。</p>
    </div>
    {% endif %}

</div>
